webpackJsonp([1],{"2EII":function(e,t,s){e.exports=s.p+"static/img/webwxgetmsgimg.9882800.jpeg"},Hktm:function(e,t,s){e.exports=s.p+"static/img/user.f0d7ba3.jpeg"},LrDZ:function(e,t){},MBHH:function(e,t){},NHnr:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("7+uW"),n={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var i=s("VU/8")({name:"App"},n,!1,function(e){s("iOeo")},null,null).exports,r=s("mtWM"),o=s.n(r),c=s("Rf8U"),u=s.n(c),l=s("/ocq"),d={name:"Login",data:()=>({msg:"this is login vue",name:"",password:"",email:"",loginActive:!0}),methods:{login:async function(){try{let e=(await this.$store.dispatch("login",{name:this.name,password:this.password})).data[0];sessionStorage.setItem("user",JSON.stringify(e)),this.$store.commit("updateSessionUser",e),this.$store.commit("createWs",e),window.location="/#/index"}catch(e){this.$message.error("登录失败，请重新登录",e)}},registry:function(){if(this.loginActive)this.loginActive=!1;else try{this.$store.dispatch("registry",{name:this.name,password:this.password,email:this.email}),this.$message("注册成功，请重新登录"),this.loginActive=!0}catch(e){this.$message.error("注册失败",e)}},cancel:function(){this.loginActive=!0}}},m={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"body"},[s("div",{staticClass:"item"},[s("label",{staticClass:"item-label"},[e._v("请输入用户名")]),e._v(" "),s("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),s("div",{staticClass:"item"},[s("label",{staticClass:"item-label"},[e._v("请输入密码")]),e._v(" "),s("el-input",{attrs:{placeholder:"请输入内容","show-password":""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1),e._v(" "),e.loginActive?e._e():s("div",{staticClass:"item"},[s("label",{staticClass:"item-label"},[e._v("请输入邮箱")]),e._v(" "),s("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}})],1),e._v(" "),e.loginActive?s("div",{staticClass:"item-foot"},[s("el-button",{on:{click:e.login}},[e._v("登录")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.registry}},[e._v("注册")])],1):e._e(),e._v(" "),e.loginActive?e._e():s("div",{staticClass:"item-foot"},[s("el-button",{attrs:{type:"primary"},on:{click:e.registry}},[e._v("注册")]),e._v(" "),s("el-button",{on:{click:e.cancel}},[e._v("取消")])],1)])},staticRenderFns:[]};var v=s("VU/8")(d,m,!1,function(e){s("O0HX")},"data-v-41f5607e",null).exports,p={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e._l(e.getFriends,function(t){return[s("div",{key:t.ID,staticClass:"item",class:{active:e.isActive(t)},on:{click:function(s){return e.upadteUser(t)}}},[e._m(0,!0),e._v(" "),s("div",{staticClass:"item-right"},[s("div",{staticClass:"title"},[s("div",[e._v(" "+e._s(t.Name)+" ")])]),e._v(" "),s("div",{staticClass:"content"},[e._v(e._s(t.LastMessage))])])])]})],2)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"item-left"},[t("img",{staticClass:"img",attrs:{src:s("Hktm")}})])}]};var h=s("VU/8")({name:"userList",methods:{upadteUser:function(e){this.$store.commit("setCurrentUser",e)},isActive:function(e){return this.$store.state.currentUser.Name===e.Name}},created:async function(){let e=(await this.$store.dispatch("getAllFriends")).data[0];this.$store.commit("setCurrentUser",e[0]),this.$store.commit("updateUses",e)},computed:{getFriends:function(){return this.$store.state.users}}},p,!1,function(e){s("m8+G")},"data-v-3a5cbd62",null).exports,f={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"modal-box"},[s("div",{staticClass:"modal-header"},[s("div",[e._v("添加用户")]),e._v(" "),s("div",{staticClass:"el-icon-close",on:{click:e.closeModal}})]),e._v(" "),s("el-input",{attrs:{placeholder:"请输入内容",clearable:""},on:{input:e.inputEvent},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),e._v(" "),s("div",{staticClass:"modal-item"},[e._l(e.users,function(t){return[s("div",{key:t.ID,staticClass:"user-list"},[s("div",[e._v(e._s(t.Name))]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(s){return e.addFriend(t)}}},[e._v("添加好友")])],1)]}),e._v(" "),e.users.length?e._e():s("div",[e._v("暂无查询结果")])],2)],1)},staticRenderFns:[]};var g=s("VU/8")({name:"AddUSer",data:function(){return{value:"",users:[]}},methods:{inputEvent:async function(){""!==this.value?await this.searchUser():this.users=[]},searchUser:async function(){try{this.users=(await this.$store.dispatch("searchUsers",{search:this.value})).data}catch(e){this.users=[]}},addFriend:async function(e){await this.$store.dispatch("addFriend",e.ID),this.closeModal()},closeModal:function(){this.$emit("closeme")}}},f,!1,function(e){s("LrDZ")},"data-v-27ad8416",null).exports,_={name:"ChatList",data:function(){return{url:"./webwxgetmsgimg.jpeg",addUserActive:!1}},methods:{logout:function(){window.location="/#/"},addUser:function(){this.addUserActive=!this.addUserActive}},computed:{getSessionName:function(){return JSON.parse(sessionStorage.getItem("user")).Name}},components:{userList:h,AddUSer:g}},w={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"list-body"},[s("div",{staticClass:"header"},[e._m(0),e._v(" "),s("div",{staticClass:"action"},[s("el-dropdown",{attrs:{trigger:"click"}},[s("span",{staticClass:"el-dropdown-link"},[s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),s("span",[e._v(" "+e._s(e.getSessionName))]),e._v(" "),s("button",{on:{click:e.addUser}},[e._v("add")]),e._v(" "),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",{attrs:{icon:"el-icon-plus"},on:{click:e.logout}},[e._v("logout")]),e._v(" "),s("el-dropdown-item",{attrs:{icon:"el-icon-plus"},on:{click:e.addUser}},[e._v("add user")])],1)],1)],1)]),e._v(" "),s("AddUSer",{directives:[{name:"show",rawName:"v-show",value:e.addUserActive,expression:"addUserActive"}],on:{closeme:e.addUser}}),e._v(" "),s("div",{staticClass:"body"},[s("userList")],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"icon"},[t("img",{staticClass:"img",attrs:{src:s("2EII")}})])}]};var b=s("VU/8")(_,w,!1,function(e){s("bJJ/")},"data-v-2ff0b21c",null).exports,C=s("x9pK"),U=s.n(C),x={name:"UserInfo",data:function(){return{messages:[],user:JSON.parse(sessionStorage.getItem("user"))}},methods:{getPosition:function(e){return e.SourceID===this.user.ID},refreshMessages:async function(){this.$store.state.currentUser&&this.$store.state.currentUser.ID&&(this.messages=(await this.$store.dispatch("getMessage",this.$store.state.currentUser.ID)).data[0],this.messages||(this.messages=[]))}},computed:{getCurrentUser(){return this.$store.state.currentUser}},watch:{getCurrentUser:async function(e,t){await this.refreshMessages()}},mounted:function(){Pubsub.subscribe("message-sended",function(){this.refreshMessages()})}},I={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e._l(e.messages,function(t){return[s("div",{key:t.Create_At,staticClass:"item-default",class:{"item-right":e.getPosition(t)}},[s("div",{staticClass:"message-item"},[s("div",[s("el-avatar",{attrs:{src:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"}})],1),e._v(" "),s("div",[e._v(e._s(t.Content))])])])]}),e._v(" "),e.messages.length?e._e():s("div",{staticClass:"empty-message"},[e._v("no message to show")])],2)},staticRenderFns:[]};var y={name:"userSend",data:function(){return{value:""}},methods:{sendMesage:function(){this.$store.dispatch("sendMessage",{Type:0,SourceID:JSON.parse(sessionStorage.getItem("user")).ID,DestinationID:this.$store.state.currentUser.ID,Content:this.value}),console.log("ready to send message",this.value),U.a.publish("message-sended"),this.cleanInputMessage()},cleanInputMessage:function(){this.value=""}}},$={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"message-action"}),e._v(" "),s("div",{staticClass:"message-content"},[s("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4}},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1),e._v(" "),s("div",{staticClass:"message-send"},[s("el-button",{attrs:{size:"mini"},on:{click:e.sendMesage}},[e._v("sendMessage")])],1)])},staticRenderFns:[]};var S={name:"ChatInfo",components:{UserInfo:s("VU/8")(x,I,!1,function(e){s("QTCQ")},"data-v-0bbe69ab",null).exports,userSend:s("VU/8")(y,$,!1,function(e){s("aWkz")},"data-v-30d221d6",null).exports},computed:{userName:function(){return this.$store.state.currentUser?this.$store.state.currentUser.Name:"default"}}},k={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"body"},[t("el-header",[this._v("\n        "+this._s(this.userName)+"\n    ")]),this._v(" "),t("el-main",[t("UserInfo")],1),this._v(" "),t("el-footer",[t("userSend")],1)],1)},staticRenderFns:[]};var D={name:"Index",data:()=>({msg:"this is index vue"}),components:{ChatList:b,ChatInfo:s("VU/8")(S,k,!1,function(e){s("l61s")},"data-v-a499978e",null).exports}},A={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"body"},[t("el-container",[t("el-aside",{attrs:{width:"300px"}},[t("ChatList")],1),this._v(" "),t("el-main",[t("ChatInfo")],1)],1)],1)},staticRenderFns:[]};var N=s("VU/8")(D,A,!1,function(e){s("MBHH")},"data-v-944cb1d0",null).exports;a.default.use(l.a);var M=new l.a({routes:[{path:"/",name:"Login",component:v},{path:"/index",name:"Index",component:N,children:[{path:"/add-user",name:"AddUSer",component:g}]}]}),O=s("zL8q"),F=s.n(O),E=s("NYxO");a.default.use(E.a);var J=new E.a.Store({state:{user:{},users:[],currentUser:{},active:!1,ws:{}},mutations:{updateSessionUser:function({commit:e},t){this.state.user=Object.assign({},t)},setCurrentUser:function({commit:e},t){t.ID!==this.state.currentUser.ID&&(this.state.currentUser=Object.assign({},t))},updateUses:function({commit:e},t){this.state.users=t},createWs:function({commit:e},t){this.state.ws=new WebSocket("ws://localhost:9999/event?id="+t.ID),this.state.ws.onmessage=function(e){console.log(e.data)},this.state.ws.onopen=function(){console.log("open websocket")}}},actions:{login:async function({context:e},t){return a.default.axios.post("/api/login",Object.assign({},t))},registry:async function({context:e},t){return a.default.axios.post("/api/registry",Object.assign({},t))},getAllFriends:async function(){let e=JSON.parse(sessionStorage.getItem("user"));return a.default.axios({method:"get",url:"/api/friends",headers:{userID:e.ID}})},searchUsers:async function({context:e},t){return a.default.axios.get("/api/search/users/"+t.search)},addFriend:async function({context:e},t){let s=JSON.parse(sessionStorage.getItem("user"));return a.default.axios({method:"post",url:"/api/friends/"+t,headers:{userID:s.ID}})},createGroup:function({context:e},t){return a.default.axios.post("/api/create-group",t.group)},deleteGroup:function({context:e},t){return a.default.axios.delete("/api/delete-group/"+t.groupID)},getMessage:async function({context:e},t){let s={headers:{userID:JSON.parse(sessionStorage.getItem("user")).ID}};return a.default.axios.get("/api/messages/"+t,s)},sendMessage:async function({context:e},t){let s={headers:{userID:JSON.parse(sessionStorage.getItem("user")).ID}};return a.default.axios.post("/api/sendMessage",t,s)}}}),H=s("18Sv"),L=s.n(H);a.default.use(L.a,{persist:!0}),a.default.use(F.a),a.default.prototype.HOST="/api",a.default.use(u.a,o.a),a.default.prototype.httpHeader=function(){return{userID:JSON.parse(this.$session.get("user")).ID}},a.default.config.productionTip=!1,new a.default({el:"#app",store:J,router:M,components:{App:i},template:"<App/>"})},O0HX:function(e,t){},QTCQ:function(e,t){},aWkz:function(e,t){},"bJJ/":function(e,t){},iOeo:function(e,t){},l61s:function(e,t){},"m8+G":function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.66b4e410e1728aa8cb89.js.map