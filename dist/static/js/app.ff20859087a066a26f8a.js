webpackJsonp([1],{"+Fwa":function(e,t){},"/KpX":function(e,t){},"2EII":function(e,t,s){e.exports=s.p+"static/img/webwxgetmsgimg.9882800.jpeg"},"5CKt":function(e,t){},"7SsH":function(e,t){},Hktm:function(e,t,s){e.exports=s.p+"static/img/user.f0d7ba3.jpeg"},MQIb:function(e,t){},NHnr:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("7+uW"),n={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var i=s("VU/8")({name:"App"},n,!1,function(e){s("iOeo")},null,null).exports,r=s("mtWM"),o=s.n(r),c=s("Rf8U"),l=s.n(c),u=s("/ocq"),d={name:"Login",data:()=>({msg:"this is login vue",name:"",password:"",email:"",loginActive:!0}),methods:{login:async function(){try{let e=(await this.$store.dispatch("login",{name:this.name,password:this.password})).data[0];sessionStorage.setItem("user",JSON.stringify(e)),this.$store.commit("updateSessionUser",e),this.$store.commit("createWs",e),window.location="/#/index"}catch(e){this.$message.error("登录失败，请重新登录",e)}},registry:function(){if(this.loginActive)this.loginActive=!1;else try{this.$store.dispatch("registry",{name:this.name,password:this.password,email:this.email}),this.$message("注册成功，请重新登录"),this.loginActive=!0}catch(e){this.$message.error("注册失败",e)}},cancel:function(){this.loginActive=!0}}},v={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"body"},[s("div",{staticClass:"item"},[s("label",{staticClass:"item-label"},[e._v("请输入用户名")]),e._v(" "),s("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),s("div",{staticClass:"item"},[s("label",{staticClass:"item-label"},[e._v("请输入密码")]),e._v(" "),s("el-input",{attrs:{placeholder:"请输入内容","show-password":""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1),e._v(" "),e.loginActive?e._e():s("div",{staticClass:"item"},[s("label",{staticClass:"item-label"},[e._v("请输入邮箱")]),e._v(" "),s("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}})],1),e._v(" "),e.loginActive?s("div",{staticClass:"item-foot"},[s("el-button",{on:{click:e.login}},[e._v("登录")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.registry}},[e._v("注册")])],1):e._e(),e._v(" "),e.loginActive?e._e():s("div",{staticClass:"item-foot"},[s("el-button",{attrs:{type:"primary"},on:{click:e.registry}},[e._v("注册")]),e._v(" "),s("el-button",{on:{click:e.cancel}},[e._v("取消")])],1)])},staticRenderFns:[]};var m=s("VU/8")(d,v,!1,function(e){s("O0HX")},"data-v-41f5607e",null).exports,h=s("x9pK"),f=s.n(h),p={name:"userList",data:function(){return{users:this.$store.state.users}},methods:{upadteUser:function(e){this.$store.commit("setCurrentUser",e)},isActive:function(e){return this.$store.state.currentUser.Name===e.Name},refreshList:async function(e){let t=(await this.$store.dispatch("getAllFriends")).data[0];e&&t.map(t=>{t.ID===e.SourceID&&(t.LastMessage=e.Content,t.LatetUpdate=e.CreateAt,t.UnRead?t.UnRead=parseInt(t.UnRead)+1:t.UnRead=0)}),this.users=t}},created:async function(){let e=(await this.$store.dispatch("getAllFriends")).data[0];this.$store.commit("setCurrentUser",e[0]),this.$store.commit("updateUses",e)},mounted:function(){f.a.subscribe("refreshList",(e,t)=>{this.$notify({title:"来自用户ＩＤ为"+t.SourceID+"的消息",message:t.Content,type:"success"}),t.SourceID===this.$store.state.currentUser.ID&&f.a.publish("messageSend",{Topic:e,Data:t}),this.refreshList(t)}),f.a.subscribe("addUser",()=>{this.refreshList()})},computed:{getFriends:function(){return this.users}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._l(e.getFriends,function(t){return[a("div",{key:t.ID,staticClass:"user-item",class:{active:e.isActive(t)},on:{click:function(s){return e.upadteUser(t)}}},[a("div",{staticClass:"item-left"},[a("el-badge",{staticClass:"item",attrs:{value:t.UnRead}},[a("img",{staticClass:"img",attrs:{src:s("Hktm")}})])],1),e._v(" "),a("div",{staticClass:"item-right"},[a("div",{staticClass:"title"},[a("div",[e._v(" "+e._s(t.Name)+" ")])]),e._v(" "),a("div",{staticClass:"content"},[e._v(e._s(t.LastMessage))])])])]})],2)},staticRenderFns:[]};var _=s("VU/8")(p,g,!1,function(e){s("+Fwa")},"data-v-684eb708",null).exports,C={name:"AddUSer",data:function(){return{value:"",users:[]}},methods:{inputEvent:async function(){""!==this.value?await this.searchUser():this.users=[]},searchUser:async function(){try{this.users=(await this.$store.dispatch("searchUsers",{search:this.value})).data}catch(e){this.users=[]}},addFriend:async function(e){await this.$store.dispatch("addFriend",e.ID),f.a.publish("addUser"),this.closeModal()},closeModal:function(){this.$emit("closeme")}}},w={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"modal-box"},[s("div",{staticClass:"modal-header"},[s("div",[e._v("添加用户")]),e._v(" "),s("div",{staticClass:"el-icon-close",on:{click:e.closeModal}})]),e._v(" "),s("el-input",{attrs:{placeholder:"请输入内容",clearable:""},on:{input:e.inputEvent},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),e._v(" "),s("div",{staticClass:"modal-item"},[e._l(e.users,function(t){return[s("div",{key:t.ID,staticClass:"user-list"},[s("div",[e._v(e._s(t.Name))]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(s){return e.addFriend(t)}}},[e._v("添加好友")])],1)]}),e._v(" "),e.users.length?e._e():s("div",[e._v("暂无查询结果")])],2)],1)},staticRenderFns:[]};var U=s("VU/8")(C,w,!1,function(e){s("QqKh")},"data-v-1ef04465",null).exports,b={name:"ChatList",data:function(){return{url:"./webwxgetmsgimg.jpeg",addUserActive:!1}},methods:{logout:function(){window.location="/#/"},addUser:function(){this.addUserActive=!this.addUserActive}},computed:{getSessionName:function(){return JSON.parse(sessionStorage.getItem("user")).Name}},components:{userList:_,AddUSer:U}},y={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"list-body"},[s("div",{staticClass:"header"},[e._m(0),e._v(" "),s("div",{staticClass:"action"},[s("el-dropdown",{attrs:{trigger:"click"}},[s("span",{staticClass:"el-dropdown-link"},[s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),s("span",[e._v(" "+e._s(e.getSessionName))]),e._v(" "),s("button",{on:{click:e.addUser}},[e._v("add")]),e._v(" "),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",{attrs:{icon:"el-icon-plus"},on:{click:e.logout}},[e._v("logout")]),e._v(" "),s("el-dropdown-item",{attrs:{icon:"el-icon-plus"},on:{click:e.addUser}},[e._v("add user")])],1)],1)],1)]),e._v(" "),s("AddUSer",{directives:[{name:"show",rawName:"v-show",value:e.addUserActive,expression:"addUserActive"}],on:{closeme:e.addUser}}),e._v(" "),s("div",{staticClass:"body"},[s("userList")],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"icon"},[t("img",{staticClass:"img",attrs:{src:s("2EII")}})])}]};var I=s("VU/8")(b,y,!1,function(e){s("z5C0")},"data-v-1753b12f",null).exports,x={name:"UserInfo",data:function(){return{messages:[],user:JSON.parse(sessionStorage.getItem("user"))}},methods:{getPosition:function(e){return e.SourceID===this.user.ID},refreshMessages:async function(){this.$store.state.currentUser&&this.$store.state.currentUser.ID&&(this.messages=(await this.$store.dispatch("getMessage",this.$store.state.currentUser.ID)).data[0],this.messages||(this.messages=[]))},scrollToBottom:function(){setTimeout(()=>{let e=document.getElementsByClassName("listBody")[0];e.scrollTop=e.scrollHeight},0)}},computed:{getCurrentUser(){return this.$store.state.currentUser}},watch:{getCurrentUser:async function(e,t){await this.refreshMessages(),this.scrollToBottom()}},mounted:function(){f.a.subscribe("messageSend",this.refreshMessages),this.scrollToBottom()}},S={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"listBody"},[e._l(e.messages,function(t){return[s("div",{key:t.Create_At,staticClass:"item-default",class:{"item-right":e.getPosition(t)}},[s("div",{staticClass:"message-item"},[s("div",[s("el-avatar",{attrs:{src:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"}})],1),e._v(" "),s("div",[e._v(e._s(t.Content))])])])]}),e._v(" "),e.messages.length?e._e():s("div",{staticClass:"empty-message"},[e._v("no message to show")])],2)},staticRenderFns:[]};var $=s("VU/8")(x,S,!1,function(e){s("Y1c9")},"data-v-79af59ca",null).exports,N={name:"userSend",data:function(){return{value:""}},methods:{sendMesage:function(){this.$store.dispatch("sendMessage",{Type:0,SourceID:JSON.parse(sessionStorage.getItem("user")).ID,DestinationID:this.$store.state.currentUser.ID,Content:this.value}),f.a.publish("messageSend",this.value),this.cleanInputMessage()},cleanInputMessage:function(){this.value=""}}},k={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"message-action"}),e._v(" "),s("div",{staticClass:"message-content"},[s("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4}},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1),e._v(" "),s("div",{staticClass:"message-send"},[s("el-button",{attrs:{size:"mini"},on:{click:e.sendMesage}},[e._v("sendMessage")])],1)])},staticRenderFns:[]};var D=s("VU/8")(N,k,!1,function(e){s("/KpX")},"data-v-d40ad86a",null).exports,A={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"join-body"},[s("div",{staticClass:"header"}),e._v(" "),s("div",{staticClass:"body"},[s("div",{staticClass:"selected"},[e._l(e.selectd,function(t){return[s("div",{key:t},[e._v(e._s(t.Name))])]})],2),e._v(" "),s("div",{staticClass:"search"},[s("el-input",{model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),s("div",{staticClass:"list"},[e._l(e.filterUsers,function(t){return[s("div",{key:t},[e._v(e._s(t.Name))])]})],2)]),e._v(" "),s("div",{staticClass:"footer"})])},staticRenderFns:[]};var F={name:"Session",data:function(){return{default:void 0,users:[{Name:1},{Name:2},{Name:3}],joinActive:!1}},methods:{joinGroup:function(){this.joinActive=!0},closeJoin:function(){}},components:{Join:s("VU/8")({name:"Join",data:function(){return{users:[{Name:"A",Name:"B",Name:"C",Name:"D"}],search:""}},computed:{selectd:function(){return this.users.filter(e=>e.checked)},selectdLength:function(){return this.selectd.length},filterUsers:function(){return this.users.filter(e=>e.Name.indexOf(this.search))}}},A,!1,function(e){s("5CKt")},"data-v-7e6d20ed",null).exports}},M={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"session-body"},[s("div",{staticClass:"session-item",on:{click:e.joinGroup}},[e._v("+")]),e._v(" "),e._l(e.users,function(t){return[s("div",{key:t.Name,staticClass:"session-item"},[e._v(e._s(t.Name))])]}),e._v(" "),s("Join",{directives:[{name:"show",rawName:"v-show",value:e.joinActive,expression:"joinActive"}],on:{closeme:e.closeJoin}})],2)},staticRenderFns:[]};var O={name:"ChatInfo",components:{UserInfo:$,userSend:D,Session:s("VU/8")(F,M,!1,function(e){s("bBaW")},"data-v-558b662a",null).exports},computed:{userName:function(){return this.$store.state.currentUser?this.$store.state.currentUser.Name:"default"}},data:function(){return{active:!1}},methods:{toggle:function(){this.active=!this.active}}},R={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"body"},[s("el-header",[e._v("\n        "+e._s(e.userName)+"\n        "),s("span",{staticClass:"el-dropdown-link",on:{click:e.toggle}},[s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),s("Session",{directives:[{name:"show",rawName:"v-show",value:e.active,expression:"active"}]})],1),e._v(" "),s("el-main",[s("UserInfo")],1),e._v(" "),s("el-footer",[s("userSend")],1)],1)},staticRenderFns:[]};var L={name:"Index",data:()=>({msg:"this is index vue"}),components:{ChatList:I,ChatInfo:s("VU/8")(O,R,!1,function(e){s("7SsH")},"data-v-e9dc62fe",null).exports}},E={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"body"},[t("el-container",[t("el-aside",{attrs:{width:"300px"}},[t("ChatList")],1),this._v(" "),t("el-main",[t("ChatInfo")],1)],1)],1)},staticRenderFns:[]};var J=s("VU/8")(L,E,!1,function(e){s("MQIb")},"data-v-69072b4a",null).exports;a.default.use(u.a);var j=new u.a({routes:[{path:"/",name:"Login",component:m},{path:"/index",name:"Index",component:J,children:[{path:"/add-user",name:"AddUSer",component:U}]}]}),H=s("zL8q"),V=s.n(H),B=s("NYxO");a.default.use(B.a);var T=new B.a.Store({state:{user:{},users:[],currentUser:{},active:!1,ws:{}},mutations:{updateSessionUser:function({commit:e},t){this.state.user=Object.assign({},t)},setCurrentUser:function({commit:e},t){t.ID!==this.state.currentUser.ID&&(this.state.currentUser=Object.assign({},t))},updateUses:function({commit:e},t){this.state.users=t},createWs:function({commit:e},t){this.state.ws=new WebSocket("ws://localhost:9999/event?id="+t.ID),this.state.ws.onmessage=function(e){f.a.publish("refreshList",JSON.parse(e.data))},this.state.ws.onopen=function(){console.log("open websocket")}}},actions:{login:async function({context:e},t){return a.default.axios.post("/api/login",Object.assign({},t))},registry:async function({context:e},t){return a.default.axios.post("/api/registry",Object.assign({},t))},getAllFriends:async function(){let e=JSON.parse(sessionStorage.getItem("user"));return a.default.axios({method:"get",url:"/api/friends",headers:{userID:e.ID}})},searchUsers:async function({context:e},t){return a.default.axios.get("/api/search/users/"+t.search)},addFriend:async function({context:e},t){let s=JSON.parse(sessionStorage.getItem("user"));return a.default.axios({method:"post",url:"/api/friends/"+t,headers:{userID:s.ID}})},createGroup:function({context:e},t){return a.default.axios.post("/api/create-group",t.group)},deleteGroup:function({context:e},t){return a.default.axios.delete("/api/delete-group/"+t.groupID)},getMessage:async function({context:e},t){let s={headers:{userID:JSON.parse(sessionStorage.getItem("user")).ID}};return a.default.axios.get("/api/messages/"+t,s)},sendMessage:async function({context:e},t){let s={headers:{userID:JSON.parse(sessionStorage.getItem("user")).ID}};return a.default.axios.post("/api/sendMessage",t,s)}}}),K=s("18Sv"),W=s.n(K);a.default.use(W.a,{persist:!0}),a.default.use(V.a),a.default.prototype.HOST="/api",a.default.use(l.a,o.a),a.default.prototype.httpHeader=function(){return{userID:JSON.parse(this.$session.get("user")).ID}},a.default.config.productionTip=!1,new a.default({el:"#app",store:T,router:j,components:{App:i},template:"<App/>"})},O0HX:function(e,t){},QqKh:function(e,t){},Y1c9:function(e,t){},bBaW:function(e,t){},iOeo:function(e,t){},z5C0:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.ff20859087a066a26f8a.js.map